<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Fact-Check Lab â€” Nicolas Tuor</title>
  <link rel="stylesheet" href="./style.css">
  <style>
    .lab { max-width: 960px; margin: 0 auto; }
    .cardy { background: var(--panel); border:1px solid color-mix(in oklab,var(--ink),transparent 85%); border-radius:16px; padding:16px; box-shadow:var(--shadow); }
    .row { display:flex; gap:10px; }
    .row > * { flex:1; }
    .muted { opacity:.8 }
    .list { display:grid; gap:10px; }
    .item { background: var(--bg-soft); border:1px solid color-mix(in oklab,var(--ink),transparent 85%); border-radius:10px; padding:10px; }
    .small { font-size:.9rem }
    textarea { width:100%; min-height:120px; border-radius:12px; padding:12px; background:var(--bg-soft); color:var(--ink); border:1px solid color-mix(in oklab,var(--ink),transparent 80%) }
  </style>
</head>
<body>
<header class="nav"><div class="container">
  <a class="brand" href="./index.html"><span class="brand-badge">NT</span><span class="brand-text">Nicolas Tuor</span></a>
  <nav class="nav-links"><a href="./cv.html">CV</a><a href="./portfolio.html">Portfolio</a><a href="./ai-lab.html">AI Lab</a><a href="./chatbot.html">Chatbot</a></nav>
  <div class="nav-links"><button class="btn linkish" data-toggle-theme>ðŸŒ“</button></div>
</div></header>

<main class="section container lab">
  <h1 class="title">ðŸ”Ž AI Fact-Check Lab</h1>
  <p class="lead">Colle une affirmation (ou un mini-titre dâ€™article). Lâ€™IA propose des pistes de vÃ©rification et te fait rÃ©flÃ©chir avant de donner un verdict.</p>

  <section class="cardy">
    <label for="claim"><strong>Affirmation</strong></label>
    <textarea id="claim" placeholder="ex. 'Les Ã©crans bleus la nuit amÃ©liorent le sommeil.'"></textarea>
    <div class="row">
      <input id="topic" placeholder="Sujet (optionnel), ex. Ã©ducation, santÃ©, IA">
      <button id="gen" class="btn primary">GÃ©nÃ©rer les vÃ©rifications</button>
    </div>
  </section>

  <section id="checks" class="list" style="margin-top:14px"></section>

  <section id="reflect" class="cardy" style="display:none;margin-top:14px">
    <label for="self"><strong>Ton analyse (3-5 phrases)</strong></label>
    <textarea id="self" placeholder="Explique si lâ€™affirmation te paraÃ®t crÃ©dible, quelles sources tu consulterais, et pourquoi."></textarea>
    <button id="judge" class="btn">Demander un feedback</button>
  </section>

  <section id="feedback" class="cardy" style="display:none;margin-top:14px"></section>
</main>

<script>
const $ = sel => document.querySelector(sel);
const checks = $('#checks'); const reflect = $('#reflect'); const feedback = $('#feedback');

$('#gen').onclick = async () => {
  checks.innerHTML = ''; feedback.style.display='none';
  const claim = $('#claim').value.trim(); if(!claim) return alert('Ã‰cris une affirmation.');
  const topic = $('#topic').value.trim();

  const r = await fetch('/api/factcheck', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ mode:'generate', claim, topic, lang:'fr' })
  });
  const j = await r.json();

  checks.innerHTML = j.tasks.map((t,i)=>`
    <div class="item">
      <div><strong>Ã‰tape ${i+1} â€” ${t.title}</strong></div>
      <div class="small muted">${t.hint}</div>
      ${t.options.map((o,idx)=>`
        <label style="display:block;margin-top:8px">
          <input type="radio" name="q${i}" value="${idx}"> ${o}
        </label>`).join('')}
      <div class="small muted" style="margin-top:6px">Sources suggÃ©rÃ©es : ${t.sources.join(', ')}</div>
    </div>
  `).join('');

  reflect.style.display='block';
  reflect.dataset.payload = JSON.stringify(j);
};

$('#judge').onclick = async () => {
  const lab = JSON.parse(reflect.dataset.payload || '{}');
  const answers = (lab.tasks || []).map((t,i)=>{
    const el = document.querySelector(`input[name="q${i}"]:checked`);
    return el ? Number(el.value) : null;
  });

  const r = await fetch('/api/factcheck', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ mode:'judge', lab, answers, self: $('#self').value.trim(), lang:'fr' })
  });
  const j = await r.json();

  feedback.style.display='block';
  feedback.innerHTML = `
    <div><strong>Retour de lâ€™IA</strong></div>
    <p>${j.summary}</p>
    <div class="small muted">${j.tips || ''}</div>
  `;
};
</script>

<script src="./site.js" defer></script>
<script>(function(){const K="theme",H=document.documentElement,S=localStorage.getItem(K);if(S)H.setAttribute("data-theme",S);function set(t){H.setAttribute("data-theme",t);localStorage.setItem(K,t);}document.addEventListener("click",e=>{const t=e.target.closest("[data-toggle-theme]");if(!t)return;set(H.getAttribute("data-theme")==="light"?"dark":"light");});if(!S)set("dark");})();</script>
</body>
</html>
