<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatbot IA — Nicolas Tuor</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/style.css" />
  <style>
    /* Habillage local discret pour la page chatbot */
    :root{
      --bd:#ffffff22; --ink:#e6f1ff; --ink-dim:#cfe2ff;
      --panel:#0b2237; --panel2:#0e3b63; --panel3:#133a61;
    }
    body{color:var(--ink)}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .navbar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--bd)}
    .nav-left,.nav-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--bd);background:#0d2a45;border-radius:12px;color:var(--ink);text-decoration:none}
    .chip:hover{background:#103258}

    h1{font-size:2.2rem;margin:18px 0 2px}
    .subtitle{opacity:.85;margin:0 0 18px}

    /* Bloc du chat */
    .chat{background:rgba(255,255,255,.05);border:1px solid var(--bd);border-radius:14px;padding:16px}
    #chatLog{min-height:280px;max-height:58vh;overflow:auto;padding:8px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid var(--bd)}
    .bubble{padding:10px 12px;border-radius:12px;margin:8px 0;white-space:pre-wrap;line-height:1.4}
    .bubble.user{background:var(--panel3)}
    .bubble.bot{background:var(--panel2)}
    .bar{display:flex;gap:8px;margin-top:12px}
    .bar textarea{flex:1;min-height:68px;background:rgba(255,255,255,.04);border:1px solid var(--bd);color:var(--ink);border-radius:10px;padding:10px 12px}
    .bar button{padding:10px 14px;border-radius:10px;border:1px solid var(--bd);background:#0e3b63;color:var(--ink);cursor:pointer}
    .bar button:hover{background:#114a80}
    .hint{opacity:.8;font-size:.95rem;margin-top:8px}
    .fine{opacity:.7;font-size:.9rem}
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="navbar">
    <div class="nav-left">
      <a class="chip" href="/">Accueil</a>
      <a class="chip" href="/portfolio">Portfolio</a>
      <a class="chip" href="/cv">CV</a>
      <a class="chip" href="/chatbot">Chatbot</a>
      <a class="chip" href="/ai-lab">Idées IA</a>
      <a class="chip" href="/fun-facts">Fun Facts</a>
    </div>
    <div class="nav-right">
      <a class="chip" href="/chatbot">FR</a>
      <a class="chip" href="/chatbot-en">EN</a>
      <a class="chip" href="/chatbot-de">DE</a>
    </div>
  </header>

  <main class="container">
    <h1>Chatbot IA</h1>
    <p class="subtitle">Posez vos questions — pédagogie, IA, expérience. Le bot charge <code>/profile.json</code> si présent, sinon il s’appuie sur un extrait intégré de mon CV.</p>

    <section class="chat" id="chatBox">
      <div id="chatLog" aria-live="polite"></div>

      <div class="bar">
        <textarea id="chatInput" placeholder="Écrivez votre message… (Entrée pour envoyer, Shift+Entrée pour une nouvelle ligne)"></textarea>
        <button id="chatSend">Envoyer</button>
      </div>

      <p id="introPlaceholder" class="hint"></p>
      <p class="fine">Astuce : demandez « Quelles compétences techniques ressortent ? », « Parle-moi d’une expérience marquante », « Quelles langues parle-t-il ? ».</p>
    </section>
  </main>

  <!-- Script front-only : lit /profile.json ; fallback CV intégré -->
  <script>
  (function(){
    "use strict";
    const $ = (s,r=document)=>r.querySelector(s);
    const log = (...a)=>console.log("%c[chatbot]","color:#0af",...a);

    /* ——— Fallback CV/Profil embarqué ——— */
    const CV_FALLBACK = {
      nom: "Nicolas Tuor",
      resume: "Enseignant & ingénieur pédagogique (didactique de l’informatique, IA responsable). Expérience : formation, accompagnement, projets numériques éducatifs, pensée critique. Dév web (HTML/CSS/JS), Python (data/IA), prompt-engineering. Gestion de projet, vulgarisation.",
      langues: [
        { langue: "Français", niveau: "C2 (natif)" },
        { langue: "Allemand", niveau: "B2 (bon niveau scolaire/pro)" },
        { langue: "Anglais",  niveau: "B2–C1 (travail/lecture)" }
      ],
      competences: [
        "Didactique de l’informatique & pensée critique",
        "Intégration responsable de l’IA en éducation",
        "Conception de formations, accompagnement d’enseignants",
        "Analyse de données (Python), visualisation simple",
        "Dév web de base (HTML/CSS/JS)",
        "Gestion de projet, communication scientifique"
      ],
      interets: [
        "Vulgarisation scientifique & pensée critique",
        "Astronomie/Astrophotographie",
        "Aviron (2005–2011)",
        "Théâtre d’improvisation",
        "Technologies, outils IA (création, automatisation d’équipe IA)",
        "Arts martiaux"
      ],
      points: [
        "Approche pragmatique, rigoureuse et éthique",
        "Esprit d’équipe, collaboration interdisciplinaire",
        "Résolution de problèmes & adaptabilité"
      ],
      projetsIA: [
        "Ateliers IA responsable (explicabilité, limites, biais)",
        "Outils d’aide à l’enseignement (quiz/facts, protos front-end)",
        "Automatisations simples (scripts, prompts, pipelines légers)"
      ]
    };

    /* ——— UI ——— */
    const logEl  = $("#chatLog");
    const input  = $("#chatInput");
    const sendBt = $("#chatSend");

    function addBubble(text, who="bot"){
      const line = document.createElement("div");
      line.className = "bubble " + who;
      line.textContent = String(text ?? "");
      logEl.appendChild(line);
      logEl.scrollTop = logEl.scrollHeight;
    }

    /* ——— Chargement /profile.json si dispo ——— */
    async function loadProfile(){
      try{
        const r = await fetch("/profile.json", { cache:"no-store" });
        if(!r.ok) throw new Error("no profile.json");
        const j = await r.json();
        log("profile.json chargé");
        return j;
      }catch(e){
        log("profile.json indisponible → fallback CV intégré");
        return CV_FALLBACK;
      }
    }

    /* ——— Heuristiques de réponse (FR) ——— */
    const toPlain = (v)=>Array.isArray(v)? v.join(", ") : (typeof v==="string"? v : "");
    const textList = (arr, max=6)=> (arr||[]).slice(0,max).join(", ");

    function answerFR(q, prof){
      const msg = q.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");

      // Langues
      if (/langue|parle|idiome/.test(msg)){
        const langs = (prof.langues||[]).map(l=>`${l.langue} — ${l.niveau}`).join("; ");
        return langs || "Il parle principalement français, avec un bon niveau en anglais et allemand.";
      }
      // Centres d’intérêt / hobbies
      if (/hobbi|interet|loisir|centre dinteret/.test(msg)){
        const hob = textList(prof.interets);
        return hob ? `Centres d’intérêt : ${hob}.`
                   : "Les centres d’intérêt ne sont pas détaillés ici. Il aime apprendre et se met à niveau rapidement.";
      }
      // Compétences
      if (/competenc|skill/.test(msg)){
        const c = textList(prof.competences, 12);
        return c ? `Compétences clés : ${c}.`
                 : "Compétences pédagogie/numérique/IA indiquées de manière générale.";
      }
      // Expérience / pédagogie
      if (/experience|pedagog|enseignement|former|formation|accompagn/.test(msg)){
        return "Expérience en didactique de l’informatique, accompagnement d’enseignants, conception de formations et intégration d’outils numériques/IA en contexte éducatif.";
      }
      // IA / projets
      if (/projet.*ia|ia appliquee|automati(s|z)|prompt/.test(msg)){
        const p = textList(prof.projetsIA, 10);
        return p ? `Projets IA : ${p}.`
                 : "Expériences autour de l’IA responsable, du prototypage front et de l’automatisation simple.";
      }
      // Par défaut: réponse prudente
      return "Je peux répondre sur ses compétences, langues, expériences, centres d’intérêt ou projets IA. Exemple : « Quelles compétences techniques ressortent ? »";
    }

    /* ——— Envoi ——— */
    let PROFILE = null;
    async function ask(){
      const q = input.value.trim();
      if(!q) return;
      addBubble(q, "user");
      input.value = "";
      const a = answerFR(q, PROFILE || {});
      addBubble(a, "bot");
    }

    /* ——— Init ——— */
    (async function init(){
      PROFILE = await loadProfile();
      const intro = $("#introPlaceholder");
      if(intro){
        intro.textContent = "Exemples : Quelles compétences techniques ressortent ? • Parle-moi d’une expérience marquante. • Quelles langues parle-t-il ?";
      }
      addBubble("Bonjour ! Posez une question sur le candidat.", "bot");
    })();

    sendBt?.addEventListener("click", ask);
    input?.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); ask(); }
    });
  })();
  </script>
</body>
</html>
