<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chatbot IA â€” Nicolas Tuor</title>

  <!-- Favicon inline -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><text y="50%" x="50%" dominant-baseline="middle" text-anchor="middle" font-size="52">ðŸ¤–</text></svg>'>
  <link rel="stylesheet" href="/style.css">

  <style>
    .chat { max-width: 920px; margin: 0 auto; padding: 16px; }
    .chat-box { background: var(--panel); border:1px solid color-mix(in oklab,var(--ink),transparent 85%); border-radius:16px; padding:16px; box-shadow:var(--shadow); min-height:260px; }
    .msg { background: var(--bg-soft); border:1px solid color-mix(in oklab,var(--ink),transparent 85%); padding:10px 12px; border-radius:12px; margin:10px 0; white-space:pre-wrap }
    .me  { border-color: color-mix(in oklab, var(--brand), transparent 70%) }
    .row { display:flex; gap:10px; margin-top:10px }
    .row input { flex:1; padding:12px; border-radius:10px; border:1px solid color-mix(in oklab,var(--ink),transparent 80%); background: var(--bg-soft); color: var(--ink) }
    .muted { opacity:.85 }
    .tiny  { font-size:.85rem; opacity:.85 }
    .status-dot{ display:inline-block; width:8px; height:8px; border-radius:999px; margin-right:6px; translate:0 -1px }
    .ok { background:#16a34a }
  </style>

  <!-- =================== CONTEXTE HARDCODÃ‰ (CV + PROFIL) =================== -->
  <script>
  // â€”â€”â€” CV synthÃ©tique (extrait) â€”â€”â€”
  const CV_HARDCODED = {
    identite: {
      nom: "Nicolas Tuor",
      localisation: "Fribourg (CH)"
    },
    diplomes: [
      { titre: "Master en didactique disciplinaire (orientation informatique)", etab: "HEP Lausanne", periodes: "2020â€“2024",
        focus: ["Python", "HTML/CSS", "C++", "enseignement explicite du dÃ©bogage (travail de master)"] },
      { titre: "Bachelor enseignement prÃ©scolaire & primaire", etab: "HEP Fribourg", periodes: "2015â€“2019",
        focus: ["didactique", "philosophie pour enfants (travail de bachelor)"] }
    ],
    competences: [
      "MÃ©thodologie de recherche et analyse de donnÃ©es",
      "PÃ©dagogie, didactique et formation",
      "MaÃ®trise des outils numÃ©riques",
      "Communication scientifique et vulgarisation",
      "Travail dâ€™Ã©quipe interdisciplinaire",
      "AdaptabilitÃ©, initiative, rÃ©solution de problÃ¨mes"
    ],
    tech: ["Python","HTML/CSS/JS","C++","Moodle","Nextcloud","Outils IA (crÃ©ation dâ€™images/vidÃ©os, Copilot, Unity, n8n)"],
    experience: [
      { periode:"2019â€“â€¦", role:"Enseignant primaire (remplacements)", contexte:"plusieurs degrÃ©s / FR" },
      { periode:"2020â€“2021", role:"Enseignant titulaire 5H", contexte:"Ã‰cole de Corminboeuf" },
      { periode:"2022â€“2023", role:"Stage de master (recherche/formation)", contexte:"HEP Fribourg (CRE/ATE)" },
      { periode:"2024", role:"Formateur (journÃ©e)", contexte:"HEP Fribourg â€” Ã©ducation numÃ©rique & IA responsable" },
      { periode:"2017â€“2023", role:"Divers (service civil, soutien scolaire, archiviste, rÃ©ception, sÃ©curitÃ©)", contexte:"FR/NE" }
    ],
    langues: [
      { langue:"FranÃ§ais", niveau:"langue maternelle" },
      { langue:"Anglais", niveau:"C2" },
      { langue:"Allemand", niveau:"B2/C1" }
    ],
    interets: [
      "Vulgarisation scientifique, pensÃ©e critique",
      "Astronomie / Astrophotographie",
      "Aviron (compÃ©tition 2005â€“2011)",
      "ThÃ©Ã¢tre dâ€™improvisation",
      "Apprentissage en continu",
      "Technologies & IA (crÃ©ation, jeux vidÃ©o, automatisation n8n)",
      "Arts martiaux"
    ]
  };

  // â€”â€”â€” PROFIL / TONALITÃ‰ (nuances) â€”â€”â€”
  // Tu peux enrichir librement ce bloc avec dâ€™autres infos de â€œprofile.jsonâ€.
  const PROFILE_GUIDE = {
    resume: "Enseignant primaire suisse, orientÃ© didactique de lâ€™informatique et usages responsables de lâ€™IA.",
    valeurs: ["bienveillance pragmatique","communication claire","suivi rigoureux","curiositÃ©","apprentissage rapide"],
    regles: [
      "Toujours rester factuel et sourcer dans le CV quand câ€™est pertinent.",
      "Ne pas inventer de diplÃ´mes ou responsabilitÃ©s non listÃ©s.",
      "Sâ€™il manque une info, le dire simplement.",
      "Mentionner que Nicolas apprend vite et se met Ã  niveau rapidement quand la question touche aux langues, technologies ou nouvelles exigences."
    ]
  };

  // â€”â€”â€” SÃ©lection contextuelle : on compose un extrait court pertinent pour la question â€”â€”â€”
  function pickContextFor(question){
    const q = (question||"").toLowerCase();
    const ctx = [];

    // Bloc identitÃ© + pitch
    ctx.push(`Profil: ${CV_HARDCODED.identite.nom}, ${CV_HARDCODÃ‰D?.identite?.localisation || CV_HARDCODED.identite.localisation}. ${PROFILE_GUIDE.resume}`);

    // Filtres grossiers par mots-clÃ©s
    const wantsLang   = /langue|language|spra|english|allemand|anglais|fran|niveau/.test(q);
    const wantsHobby  = /hobb|loisir|int[Ã©e]r[Ã©e]t|passion|centre/.test(q);
    const wantsTech   = /tech|python|html|css|c\+\+|outil|num[Ã©e]rique|ia|ai|unity|copilot|n8n|moodle|nextcloud/.test(q);
    const wantsExp    = /exp[Ã©e]rience|poste|mission|remplacement|enseign|stage|projet/.test(q);
    const wantsComp   = /comp[Ã©e]tence|skill/.test(q);
    const wantsForm   = /dipl[oÃ´]me|formation|master|bachelor|[Ã©e]tude/.test(q);

    if (wantsLang){
      const langs = CV_HARDCODED.langues.map(l=>`${l.langue} (${l.niveau})`).join(", ");
      ctx.push(`Langues: ${langs}.`);
      ctx.push("Nuance: il aime apprendre et se met Ã  niveau rapidement si nÃ©cessaire.");
    }
    if (wantsHobby){
      ctx.push("Centres dâ€™intÃ©rÃªt: " + CV_HARDCODED.interets.join("; ") + ".");
    }
    if (wantsTech || wantsComp){
      ctx.push("CompÃ©tences clÃ©s: " + CV_HARDCODED.competences.join("; ") + ".");
      ctx.push("Technologies/outils: " + CV_HARDCODED.tech.join(", ") + ".");
    }
    if (wantsExp){
      ctx.push("ExpÃ©rience (sÃ©lection): " + CV_HARDCODED.experience.map(e=>`${e.periode}: ${e.role}`).join(" | ") + ".");
    }
    if (wantsForm){
      ctx.push("Formations: " + CV_HARDCODED.diplomes.map(d=>`${d.titre} (${d.etab}, ${d.periodes})`).join(" | ") + ".");
    }

    // Par dÃ©faut, donner un petit socle gÃ©nÃ©rique
    if (ctx.length <= 2){
      ctx.push("RÃ©sumÃ© compÃ©tences: " + CV_HARDCODED.competences.slice(0,4).join("; ") + " â€¦");
    }

    // RÃ¨gles de ton
    ctx.push("Directives de style: " + PROFILE_GUIDE.regles.join(" | "));

    // Compactage (Ã©viter un pavÃ©)
    let joined = ctx.join("\n");
    if (joined.length > 3600) joined = joined.slice(0, 3600) + " â€¦";
    return joined;
  }

  // â€”â€”â€” Construction du prompt envoyÃ© Ã  lâ€™API â€”â€”â€”
  async function prepareQuestion(question){
    const ctx = pickContextFor(question);
    return [
      "Contexteâ€”CV (donnÃ©es fiables) et profil:", ctx,
      "---",
      "Consigne:", 
      "â€¢ RÃ©ponds de maniÃ¨re concise et prÃ©cise en tâ€™appuyant sur le contexte ci-dessus quand il est pertinent.",
      "â€¢ Si le CV ne comporte pas lâ€™info, dis-le simplement (sans inventer),",
      "  et si câ€™est liÃ© aux langues/tech/exigences, ajoute quâ€™il apprend vite et se met Ã  niveau rapidement.",
      `Question: ${question}`
    ].join("\n");
  }
  </script>
  <!-- =================== /CONTEXTE HARDCODÃ‰ =================== -->
</head>

<body>
<header class="site-header">
  <nav class="wrap row" aria-label="Navigation principale" style="padding:10px 16px">
    <a href="/" class="btn ghost">Accueil</a>
    <a href="/portfolio.html" class="btn ghost">Portfolio</a>
    <a href="/cv.html" class="btn ghost">CV</a>
    <a href="/chatbot.html" class="btn" aria-current="page">Chatbot</a>
    <a href="/ai-lab.html" class="btn ghost">IdÃ©es IA</a>
    <a href="/fun-facts.html" class="btn ghost">Fun Facts</a>
    <span style="flex:1"></span>
    <span class="tiny"><span class="status-dot ok"></span>Contexte CV intÃ©grÃ©</span>
    <a href="/chatbot.html" class="btn">FR</a>
    <a href="/chatbot-en.html" class="btn ghost">EN</a>
    <a href="/chatbot-de.html" class="btn ghost">DE</a>
  </nav>
</header>

<main class="section container chat">
  <h1 class="title">ðŸ¤– Chatbot IA</h1>
  <p class="lead">Posez vos questions â€” pÃ©dagogie, IA, expÃ©rience. Le bot sâ€™appuie en continu sur mon CV (intÃ©grÃ©) et mon profil.</p>

  <div id="chat" class="chat-box" aria-live="polite"></div>

  <div class="row">
    <input id="q" type="text"
           placeholder="Exemple : Â« Quelles compÃ©tences techniques ressortent dans le CV ? Â»" />
    <button id="send" class="btn primary">Envoyer</button>
  </div>
</main>

<script>
  const chat = document.getElementById('chat');
  function add(text, me=false){
    const p = document.createElement('div');
    p.className = 'msg' + (me ? ' me' : '');
    p.textContent = text;
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
  }

  // Message dâ€™accueil
  add(
`Bonjour ! Posez une question sur le candidat.

Exemples :
â€¢ Quelles compÃ©tences techniques ressortent ?
â€¢ Parle-moi dâ€™une expÃ©rience marquante.
â€¢ Quelles langues parle-t-il ? (il apprend vite et se met Ã  niveau si besoin)
(Le bot sâ€™appuie automatiquement sur un extrait intÃ©grÃ© du CV.)`
  );

  async function ask(){
    const q = document.getElementById('q');
    const raw = (q.value || "").trim();
    if (!raw) return;
    add(raw, true);
    q.value = "";
    add("â€¦");

    try {
      const withCtx = await prepareQuestion(raw);   // â¬…ï¸ injection systÃ©matique du contexte

      const r = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          question: withCtx,
          lang: 'fr'
        })
      });
      const j = await r.json().catch(()=>({}));
      chat.lastChild.textContent = j && j.answer ? j.answer : "Dâ€™accord. Pouvez-vous prÃ©ciser ?";
    } catch (e) {
      chat.lastChild.textContent = "Oups â€” impossible de rÃ©pondre pour lâ€™instant.";
      console.error(e);
    }
  }

  document.getElementById('send').addEventListener('click', ask);
  document.getElementById('q').addEventListener('keydown', e => { if (e.key === 'Enter') ask(); });
</script>
</body>
</html>
