<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatbot IA — Nicolas Tuor</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/style.css" />
  <style>
    /* Styles locaux légers pour le chat */
    :root{ --bd:#ffffff22; --bg:#081a2d; --ink:#e6f1ff; }
    body{ background:var(--bg); color:var(--ink); }
    .container{ max-width:1100px; margin:0 auto; padding:24px; }
    .panel{ border:1px solid var(--bd); border-radius:14px; padding:16px; background:rgba(255,255,255,.04); }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid var(--bd); border-radius:12px; background:rgba(255,255,255,.06); }
    .slider{ display:flex; align-items:center; gap:8px; }
    .slider input{ width:160px; }
    #chatLog{ height:420px; overflow:auto; padding:12px; border:1px solid var(--bd); border-radius:12px; background:rgba(0,0,0,.25); }
    .bubble{ max-width:80%; padding:10px 12px; margin:8px 0; border:1px solid var(--bd); border-radius:12px; background:rgba(255,255,255,.06); }
    .bubble.user{ margin-left:auto; background:rgba(72,135,200,.25); }
    .bubble.bot { margin-right:auto; }
    #askRow{ display:flex; gap:8px; margin-top:10px; }
    #chatInput{ flex:1; min-height:64px; padding:10px; border:1px solid var(--bd); border-radius:10px; background:#0b1f33; color:var(--ink); }
    button.btn{ padding:10px 14px; border-radius:10px; border:1px solid var(--bd); background:#0e3b63; color:var(--ink); cursor:pointer; }
    button.btn:hover{ filter:brightness(1.1); }
  </style>
</head>
<body>
  <main class="container">
    <h1>Chatbot IA</h1>
    <p>Posez vos questions — pédagogie, IA, expérience. Le bot charge <code>/profile.json</code> si présent ; sinon il s’appuie sur un extrait intégré de mon CV.</p>

    <div class="row" style="margin:10px 0 14px">
      <div class="chip slider">
        <strong>Liberté</strong>
        <input type="range" id="creativity" min="0" max="2" step="0.1" value="1.0" />
        <span id="creativityVal">1.0</span>
      </div>
      <div class="chip">Astuce : essayez « Quelles compétences techniques ressortent ? », « Parle-moi d’une expérience marquante. », « Quels sont ses centres d’intérêt ? ».</div>
    </div>

    <div class="panel">
      <div id="chatLog" aria-live="polite"></div>
      <div id="askRow">
        <textarea id="chatInput" placeholder="Écrivez votre message… (Entrée pour envoyer, Shift+Entrée pour une nouvelle ligne)"></textarea>
        <button id="chatSend" class="btn">Envoyer</button>
      </div>
    </div>
  </main>

  <script>
  /* Chatbot FR (front-only) — profil JSON + CV embarqué — avec « Liberté » réglable */
  (function(){
    "use strict";

    // ---------- DOM ----------
    const logEl   = document.getElementById("chatLog");
    const inputEl = document.getElementById("chatInput");
    const sendBtn = document.getElementById("chatSend");
    const slider  = document.getElementById("creativity");
    const sVal    = document.getElementById("creativityVal");

    let FLEX = parseFloat(localStorage.getItem("nt_chat_flex") || slider.value) || 1.0;
    slider.value = FLEX.toFixed(1);
    sVal.textContent = slider.value;

    slider.addEventListener("input", () => {
      FLEX = parseFloat(slider.value) || 1.0;
      sVal.textContent = slider.value;
      localStorage.setItem("nt_chat_flex", FLEX);
    });

    function addBubble(text, who="bot"){
      const line = document.createElement("div");
      line.className = "bubble " + who;
      line.textContent = String(text || "");
      logEl.appendChild(line);
      logEl.scrollTop = logEl.scrollHeight;
    }

    // ---------- Profil : /profile.json ou fallback ----------
    const CV_FALLBACK = {
      nom: "Nicolas Tuor",
      resume: "Enseignant & ingénieur pédagogique (didactique de l’informatique, IA responsable). Formation, accompagnement, projets numériques éducatifs, pensée critique. Dev web (HTML/CSS/JS), Python (data/IA), prompt-engineering.",
      langues: [
        { langue: "Français", niveau: "C2 (natif)" },
        { langue: "Allemand", niveau: "B2 (scolaire/pro)" },
        { langue: "Anglais",  niveau: "B2–C1 (travail/lecture)" }
      ],
      competences: [
        "Didactique de l’informatique & pensée critique",
        "Intégration responsable de l’IA en éducation",
        "Conception de formations, accompagnement d’enseignants",
        "Analyse de données (Python), visualisation simple",
        "Développement web (HTML/CSS/JS)",
        "Gestion de projet, communication scientifique"
      ],
      interets: [
        "Vulgarisation scientifique, pensée critique",
        "Astronomie / Astrophotographie",
        "Aviron (2005–2011)",
        "Théâtre d’improvisation",
        "Technologies, outils IA (création/automatisation)",
        "Arts martiaux"
      ],
      points: [
        "Curieux, apprend vite et s’adapte",
        "Esprit d’équipe, approche rigoureuse",
        "Sens pédagogique et éthique"
      ],
      projetsIA: [
        "Ateliers d’IA responsable (limites/biais)",
        "Prototypage d’outils pédagogiques (quiz/facts)",
        "Automatisations légères (scripts, prompts)"
      ]
    };

    async function loadProfile(){
      try{
        const r = await fetch("/profile.json", { cache:"no-store" });
        if(!r.ok) throw new Error("no profile.json");
        const j = await r.json();
        return j && typeof j === "object" ? j : CV_FALLBACK;
      }catch{ return CV_FALLBACK; }
    }

    // ---------- Boîte à outils « conversationnelles » ----------
    const pick = (arr)=>arr[Math.floor(Math.random()*arr.length)];
    const joinList = (arr)=> arr.length <= 1 ? (arr[0]||"") :
                       arr.length === 2 ? `${arr[0]} et ${arr[1]}` :
                       `${arr.slice(0,-1).join(", ")} et ${arr[arr.length-1]}`;

    function hedge(level=FLEX){
      const base = [
        "À ma connaissance, ",
        "D’après son profil, ",
        "Selon son CV, ",
        "D’après les éléments fournis, "
      ];
      const freer = [
        "Tout porte à penser que ",
        "On peut raisonnablement dire que ",
      ];
      return (level >= 1.4) ? pick(base.concat(freer)) : pick(base);
    }
    function closing(level=FLEX){
      const lines = [
        "Souhaitez-vous un exemple concret ?",
        "Je peux détailler si besoin.",
        "On peut creuser un point précis si vous voulez."
      ];
      return (level >= .8) ? " " + pick(lines) : "";
    }

    function find(words, text){
      const t = (text||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");
      return words.some(w => t.includes(w));
    }

    // ---------- Intentions & réponses ----------
    function ansHobbies(p){
      const hob = (p.interets||[]).slice(0,6);
      if (hob.length){
        const phr = [
          `Côté centres d’intérêt, ${joinList(hob)}.`,
          `Il s’intéresse notamment à ${joinList(hob)}.`
        ];
        const intro = FLEX >= .9 ? hedge() : "";
        return intro + pick(phr);
      }
      // pas listé → petite interprétation si FLEX>0.6
      if (FLEX > .6){
        return hedge() + "rien n’est listé explicitement, mais il est curieux et se met rapidement à niveau.";
      }
      return "Les centres d’intérêt ne sont pas détaillés ici.";
    }

    function ansLangues(p){
      const ls = (p.langues||[]).map(l => `${l.langue}: ${l.niveau}`);
      if (ls.length){
        return hedge() + joinList(ls) + ".";
      }
      return "Langues non précisées ; à minima français courant, et anglais/allemand utilisables.";
    }

    function ansCompetences(p){
      const c = (p.competences||[]).slice(0,10);
      if (c.length){
        const openers = [
          "Compétences clés : ",
          "Ce qui ressort techniquement : ",
          "Sur le plan pratique : "
        ];
        return pick(openers) + joinList(c) + ".";
      }
      return hedge() + "les compétences sont indiquées de manière générale (pédagogie, numérique, IA).";
    }

    function ansExperience(p){
      const lines = [
        "Didactique de l’informatique, intégration d’outils numériques/IA, accompagnement d’enseignants.",
        "Conception et animation de formations, projets orientés impact et usages responsables.",
      ];
      return hedge() + pick(lines) + closing();
    }

    function ansLeadership(p){
      const hints = p.points || [];
      const likely = find(["equipe","collabor","projet"], (p.points||[]).join(" ").toLowerCase());
      if (likely || FLEX >= 1.2){
        return hedge() + "à l’aise en coordination d’initiatives pédagogiques et travail d’équipe ; style pragmatique et rigoureux." + closing();
      }
      return "Pas d’expérience managériale explicite dans l’extrait, mais il collabore facilement.";
    }

    function ansUnique(p){
      const facets = [
        "sens critique et éthique autour de l’IA",
        "double culture pédagogie ↔ technique",
        "capacité à prototyper rapidement",
        "vulgarisation claire et orientée usages"
      ];
      const plus = (p.points||[]).slice(0,2);
      return hedge() + `ce qui le distingue : ${joinList(facets.concat(plus).slice(0,4))}.`;
    }

    const INTENTS = [
      {name:"hobbies",     test:q=>/\b(hobbi|loisir|centre.s?\s+d[’' ]?int[eé]r[eê]t|passion|activit[eé]s?)\b/i.test(q), fn:ansHobbies},
      {name:"langues",     test:q=>/(langue|idiome|parle(r)?)/i.test(q), fn:ansLangues},
      {name:"skills",      test:q=>/(comp[eé]tenc|skill|techn|stack|outil)/i.test(q), fn:ansCompetences},
      {name:"experience",  test:q=>/(exp[eé]rience|enseignement|former|formation|accompagn|p[eé]dagog)/i.test(q), fn:ansExperience},
      {name:"leadership",  test:q=>/(diriger|g[eé]rer une ?e?quipe|lead|manager)/i.test(q), fn:ansLeadership},
      {name:"unique",      test:q=>/(distingu|atout|point fort|force)/i.test(q), fn:ansUnique},
    ];

    // ---------- Moteur ----------
    let PROFILE = null;

    function answer(q){
      const msg = (q||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");
      for (const it of INTENTS){
        if (it.test(msg)) return it.fn(PROFILE||{});
      }
      // fallback conversationnel : petite synthèse prudente
      const base = [
        "Je peux répondre sur ses compétences, langues, centres d’intérêt, projets IA, qualités pédagogiques.",
        "Dites-moi si vous préférez un exemple d’atelier, un détail technique ou un point fort."
      ];
      if (FLEX >= 1.3){
        const plus = pick([
          "Il est curieux, apprend vite et aime relier pédagogie et usages concrets.",
          "Il essaie de rendre l’IA utile, sûre et compréhensible pour les apprenants."
        ]);
        return plus + " " + base[1];
      }
      return base[0];
    }

    async function ask(){
      const q = inputEl.value.trim();
      if(!q) return;
      addBubble(q, "user");
      inputEl.value = "";
      const a = answer(q);
      addBubble(a, "bot");
    }

    // ---------- Init ----------
    (async function init(){
      PROFILE = await loadProfile();
      addBubble("Bonjour ! Posez une question sur le candidat.", "bot");
    })();

    sendBtn.addEventListener("click", ask);
    inputEl.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); ask(); }
    });
  })();
  </script>
</body>
</html>
