<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatbot IA â€” Nicolas Tuor</title>

  <!-- Favicon inline pour Ã©viter le 404 ; remplace par ton fichier si tu veux -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="%230e3b63"/><text x="16" y="22" font-size="16" text-anchor="middle" fill="white">ðŸ¤–</text></svg>' />

  <style>
    :root{
      --bg:#081a2d; --panel:#0c1e37; --bd:#ffffff22; --ink:#e6f1ff; --muted:#bcd3ff;
      --accent:#0e7dd8; --bubble:#0e2f55; --bubble-user:#0d3e6e; --btn:#0e3b63;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      line-height:1.45;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    h1{margin:.2rem 0 .5rem}
    .hint{opacity:.8;margin:.5rem 0 1rem}

    /* Slider libertÃ© */
    .libre-row{display:flex;align-items:center;gap:14px;margin:8px 0 12px}
    .libre-label{white-space:nowrap}
    .slider{
      --pos: 0%; /* rempli via JS */
      appearance:none;width:320px;height:8px;border-radius:999px;
      background:linear-gradient(to right,#2aa3ff,var(--accent)) no-repeat;
      background-size:var(--pos) 100%;
      background-color:#0a1a30;border:1px solid var(--bd);outline:0;cursor:pointer;
    }
    .slider::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;border:2px solid var(--accent)}
    .slider::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#fff;border:2px solid var(--accent)}
    .libre-val{width:2ch;text-align:right}

    /* Chat */
    .chatbox{background:var(--panel);border:1px solid var(--bd);border-radius:10px;padding:12px}
    .log{max-height:min(60vh,560px);overflow:auto;padding:6px}
    .bubble{
      background:var(--bubble); border:1px solid var(--bd); color:var(--ink);
      padding:10px 12px; border-radius:12px; margin:10px 0; max-width:900px;
      white-space:pre-wrap;
    }
    .bubble.user{background:var(--bubble-user); margin-left:auto}
    .typing{opacity:.8}
    .input-row{display:flex;gap:8px;align-items:stretch;margin-top:10px}
    textarea{
      flex:1; min-height:52px; max-height:220px; resize:vertical;
      background:#0b223f; color:var(--ink);
      border:1px solid var(--bd); border-radius:10px; padding:12px; line-height:1.35;
    }
    button{
      background:var(--btn); color:var(--ink); border:1px solid var(--bd); border-radius:10px;
      padding:10px 14px; cursor:pointer;
    }
    button:hover{filter:brightness(1.05)}
    .examples{opacity:.8;margin:.5rem 0}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Chatbot IA</h1>

    <div class="libre-row">
      <div class="libre-label">LibertÃ©</div>
      <input id="freedom" class="slider" type="range" min="0" max="2" step="1" value="1" />
      <strong class="libre-val" id="freedomVal">1</strong>
    </div>

    <div class="hint">
      Posez vos questions â€” pÃ©dagogie, IA, expÃ©rience. Le bot charge <code>/profile.json</code> si prÃ©sent, sinon il sâ€™appuie sur un extrait intÃ©grÃ© de mon CV.  
      <br/>Astuce : essayez Â« Quelles compÃ©tences techniques ressortent ? Â», Â« Parle-moi dâ€™une expÃ©rience marquante. Â», Â« Quels sont ses centres dâ€™intÃ©rÃªt ? Â».
    </div>

    <section id="chatBox" class="chatbox" aria-live="polite">
      <div id="chatLog" class="log"></div>
      <div class="input-row">
        <textarea id="chatInput" placeholder="Ã‰crivez votre messageâ€¦ (EntrÃ©e pour envoyer, Shift+EntrÃ©e pour une nouvelle ligne)"></textarea>
        <button id="chatSend">Envoyer</button>
      </div>
      <div class="examples">Exemples : â€¢ Quelles compÃ©tences techniques ressortent ? â€¢ Parle-moi dâ€™une expÃ©rience marquante. â€¢ Quelles langues parle-t-il ?</div>
    </section>
  </main>

  <script>
  (function(){
    "use strict";
    const $ = (s,r=document)=>r.querySelector(s);
    const logEl = $("#chatLog"), input = $("#chatInput"), sendBt = $("#chatSend");
    const freedom = $("#freedom"), freedomVal = $("#freedomVal");

    // -------- Slider visuel (remplissage total Ã  2/2)
    function updateSliderFill(){
      const p = (freedom.value - freedom.min) / (freedom.max - freedom.min) * 100;
      freedom.style.setProperty("--pos", p + "%");
      freedomVal.textContent = freedom.value;
    }
    freedom.addEventListener("input", updateSliderFill);
    updateSliderFill();

    // -------- CV/Profil embarquÃ© (fallback)
    const CV_FALLBACK = {
      nom: "Nicolas Tuor",
      resume: "Enseignant & ingÃ©nieur pÃ©dagogique (didactique de lâ€™informatique, IA responsable). ExpÃ©rience : formation, accompagnement, projets numÃ©riques Ã©ducatifs, pensÃ©e critique. Dev web (HTML/CSS/JS), Python (data/IA), prompt-engineering. Gestion de projet, vulgarisation.",
      langues: [
        { langue: "FranÃ§ais", niveau: "C2 (natif)" },
        { langue: "Allemand", niveau: "B2 (bon niveau scolaire/pro)" },
        { langue: "Anglais",  niveau: "B2â€“C1 (travail/lecture)" }
      ],
      competences: [
        "Didactique de lâ€™informatique & pensÃ©e critique",
        "IntÃ©gration responsable de lâ€™IA en Ã©ducation",
        "Conception de formations, accompagnement dâ€™enseignants",
        "Analyse de donnÃ©es (Python), visualisation simple",
        "DÃ©v web de base (HTML/CSS/JS)",
        "Gestion de projet, communication scientifique"
      ],
      interets: [
        "Vulgarisation scientifique & pensÃ©e critique",
        "Astronomie / Astrophotographie",
        "Aviron (2005â€“2011)",
        "ThÃ©Ã¢tre dâ€™impro",
        "Technologies & outils IA (crÃ©ations, automatisations dâ€™Ã©quipe IA)",
        "Arts martiaux"
      ],
      projetsIA: [
        "Ateliers IA responsable (explicabilitÃ©, limites, biais)",
        "Outils dâ€™aide Ã  lâ€™enseignement (quiz/facts, protos front-end)",
        "Automatisations simples (scripts, prompts, pipelines lÃ©gers)"
      ],
      pointsForts: [
        "Approche pragmatique, rigoureuse et Ã©thique",
        "Esprit dâ€™Ã©quipe et coordination",
        "CapacitÃ© dâ€™apprentissage rapide & adaptabilitÃ©"
      ],
      stylePedago: [
        "Pratique, fondÃ© sur lâ€™explicitation, le feedback, et la pensÃ©e critique",
        "Passerelle thÃ©orie â†’ usages concrets en classe"
      ]
    };

    // -------- merge utile
    function uniq(arr){ return Array.from(new Set(arr)); }
    function mergeProfile(base, extra){
      const out = JSON.parse(JSON.stringify(base));
      const keysList = ["langues","competences","interets","projetsIA","pointsForts","stylePedago"];
      for(const k of keysList){
        const a = (base[k]||[]), b = (extra[k]||[]);
        if(Array.isArray(a) && Array.isArray(b)){
          if(typeof a[0]==="object"){ // langues
            const map = new Map();
            [...a, ...b].forEach(x=>map.set((x.langue||x.name||JSON.stringify(x)).toLowerCase(), x));
            out[k] = Array.from(map.values());
          } else {
            out[k] = uniq([...a, ...b]);
          }
        }
      }
      for(const k of ["resume","nom"]) out[k] = extra[k] || out[k];
      return out;
    }

    async function loadProfile(){
      try{
        const r = await fetch("/profile.json",{cache:"no-store"});
        if(!r.ok) throw new Error("no profile.json");
        const j = await r.json();
        return mergeProfile(CV_FALLBACK, j||{});
      }catch(e){
        return CV_FALLBACK;
      }
    }

    // -------- Chat UI helpers
    function addBubble(text, who="bot"){
      const div=document.createElement("div");
      div.className="bubble " + who;
      div.textContent=String(text||"");
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
      return div;
    }
    function addTyping(){
      const div=document.createElement("div");
      div.className="bubble typing";
      let i=0, base="â€¦";
      const tick=()=>{ i=(i+1)%4; div.textContent="Je rÃ©flÃ©chis"+(".".repeat(i)); t= setTimeout(tick, 400); };
      let t=setTimeout(tick, 200);
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
      return ()=>{ clearTimeout(t); div.remove(); };
    }
    function latency(ms){
      return new Promise(res=>setTimeout(res, ms));
    }

    // -------- NLP lÃ©ger & intents
    function norm(s){ return String(s||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,""); }
    function includesAny(s, arr){ s=norm(s); return arr.some(k=>s.includes(norm(k))); }

    function classify(q){
      const s=norm(q);
      if(includesAny(s,["langue","parle","idiome","anglais","allemand","francais"])) return "langues";
      if(includesAny(s,["hobby","hobbie","loisir","interet","centre d interet","passe-temps"])) return "hobbies";
      if(includesAny(s,["competenc","skill","points forts","point fort","qualite"])) return "competences";
      if(includesAny(s,["experience","parle moi d une experience","parcours","projet marquant"])) return "experience";
      if(includesAny(s,["projet ia","ia appliquee","prompt","automati","assistant","bot"])) return "projetsIA";
      if(includesAny(s,["equipe","manager","leader","coordination","mener une equipe"])) return "equipe";
      if(includesAny(s,["style pedag","enseigne","approche pedagog","didactique"])) return "pedagogie";
      if(includesAny(s,["distingue","unique","avantage","atout"])) return "distinctif";
      if(includesAny(s,["recette","cuisine","gateau","tarte"])) return "horssujet";
      return "general";
    }

    function textList(arr, sep=", "){ return (arr||[]).join(sep); }
    function langList(arr){
      return (arr||[]).map(l=>`${l.langue||l.name} â€” ${l.niveau||l.level||"niveau non prÃ©cisÃ©"}`).join("; ");
    }

    function softAssertProfile(prof, field, def){
      return (Array.isArray(prof[field]) && prof[field].length)? prof[field] : (def||[]);
    }

    function answer(q, prof, free){
      const intent = classify(q);

      // RÃ©ponses par intent â€” modulÃ©es par "free"
      if(intent==="horssujet"){
        return "Je peux rÃ©pondre au sujet du candidat (compÃ©tences, langues, pÃ©dagogie, IA, expÃ©riences). Sur une recette de tarte, je nâ€™ai pas dâ€™infos utiles ici ðŸ™‚.";
      }

      if(intent==="langues"){
        const txt = langList(prof.langues)||"Principalement franÃ§ais, anglais et allemand avec un bon niveau de travail.";
        if(free==0) return txt;
        if(free==1) return txt + " â€” Il peut aussi sâ€™adapter rapidement Ã  dâ€™autres contextes linguistiques si besoin.";
        return txt + " â€” Approche pragmatique : lorsquâ€™une langue est nÃ©cessaire, il se met Ã  niveau efficacement.";
      }

      if(intent==="hobbies"){
        const ints = textList(prof.interets) || null;
        if(free==0) return ints? `Centres dâ€™intÃ©rÃªt : ${ints}.` : "Rien de listÃ© prÃ©cisÃ©ment.";
        if(free==1) return ints? `Centres dâ€™intÃ©rÃªt : ${ints}.` : "Rien de listÃ© prÃ©cisÃ©ment ; il apprend vite et sait sâ€™approprier un nouveau sujet.";
        return ints? `On retrouve notamment : ${ints}.` : "Pas dâ€™Ã©lÃ©ments listÃ©s ; curieux et adaptable, il sâ€™implique volontiers sur un thÃ¨me nouveau.";
      }

      if(intent==="competences"){
        const comps = textList(prof.competences);
        if(free==0) return comps || "CompÃ©tences pÃ©dagogie/numÃ©rique/IA indiquÃ©es de maniÃ¨re gÃ©nÃ©rale.";
        if(free==1) return (comps? `CompÃ©tences clÃ©s : ${comps}. `:"") + "Points forts : " + textList(prof.pointsForts||[]) + ".";
        return (comps? `CompÃ©tences clÃ©s : ${comps}. `:"") + "Il relie thÃ©orie et usages concrets, avec une dÃ©marche rigoureuse et orientÃ©e impact.";
      }

      if(intent==="experience"){
        if(free==0) return "ExpÃ©rience en didactique de lâ€™informatique, accompagnement dâ€™enseignants et intÃ©gration dâ€™outils numÃ©riques/IA.";
        if(free==1) return "ExpÃ©rience en formation et projets numÃ©riques Ã©ducatifs ; focus IA responsable et transposition en classe.";
        return "ExpÃ©rience : formations, accompagnement, projets pÃ©dagogiques oÃ¹ lâ€™IA est utilisÃ©e de maniÃ¨re explicite, critique et utile.";
      }

      if(intent==="projetsIA"){
        const p = textList(prof.projetsIA);
        if(free==0) return p || "ExpÃ©riences variÃ©es en IA responsable et outillage pÃ©dagogique.";
        if(free==1) return (p? `Exemples : ${p}. `:"") + "Il vise des usages robustes, lisibles et reproductibles.";
        return (p? `Exemples : ${p}. `:"") + "Approche : clartÃ© des limites, prise en compte des biais, utilitÃ© pÃ©dagogique concrÃ¨te.";
      }

      if(intent==="equipe"){
        if(free==0) return "Ã€ lâ€™aise en Ã©quipe et en coordination de petites initiatives pÃ©dagogiques.";
        if(free==1) return "Ã€ lâ€™aise en Ã©quipe, coordination pragmatique et rigoureuse ; sait cadrer des tÃ¢ches pÃ©dagogiques.";
        return "Il fÃ©dÃ¨re autour dâ€™objectifs clairs et mesurables, en reliant contraintes du terrain et rÃ©sultats attendus.";
      }

      if(intent==="pedagogie"){
        const s = textList(prof.stylePedago||[]);
        if(free==0) return s || "Approche pÃ©dagogique pratique et explicite.";
        if(free==1) return (s? s+". ":"") + "Valorise lâ€™explicitation, la pensÃ©e critique et lâ€™alignement objectifs-activitÃ©s-Ã©valuation.";
        return (s? s+". ":"") + "Lâ€™idÃ©e : rendre les outils intelligibles, transfÃ©rables et Ã©thiques pour les apprenants.";
      }

      if(intent==="distinctif"){
        if(free==0) return "Didactique + IA responsable + vulgarisation : un profil qui relie technique, pÃ©dagogie et sens critique.";
        if(free==1) return "Il relie IA responsable, pÃ©dagogie et outillage simple, en gardant un regard critique sur lâ€™efficacitÃ© rÃ©elle.";
        return "Point distinctif : rendre lâ€™IA comprÃ©hensible et utile, sans surpromesse ; focus impact pÃ©dagogique mesurable.";
      }

      // GÃ©nÃ©ral
      if(free==0){
        return "Je peux rÃ©pondre sur ses compÃ©tences, langues, expÃ©riences, centres dâ€™intÃ©rÃªt, projets IA, qualitÃ©s pÃ©dagogiques.";
      }else if(free==1){
        return "Ok. PrÃ©cisez un angle (compÃ©tences techniques, langues, projet marquant, style pÃ©dagogique, points forts) et je dÃ©taille.";
      }else{
        return "Dites-moi lâ€™objectif (ex : Â« quel atout pour un poste X Â»). Je synthÃ©tise en reliant compÃ©tences, pÃ©dagogie et IA responsable.";
      }
    }

    // -------- envoi
    let PROFILE=null;

    async function ask(){
      const q = input.value.trim();
      if(!q) return;
      addBubble(q,"user");
      input.value="";
      const stopTyping = addTyping();

      // petite latence variable â€œIA-likeâ€
      const base = Math.min(700, 200 + q.length*4);
      await latency(base + Math.random()*200);

      const free = Number(freedom.value||1);
      const a = answer(q, PROFILE||CV_FALLBACK, free);

      stopTyping();
      addBubble(a,"bot");
    }

    sendBt.addEventListener("click", ask);
    input.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); ask(); }
    });

    // -------- init
    (async function init(){
      PROFILE = await loadProfile();
      addBubble("Bonjour ! Posez une question sur le candidat.","bot");
    })();
  })();
  </script>
</body>
</html>
