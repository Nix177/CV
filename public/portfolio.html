<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio — Démo Osselets</title>

  <!-- Feuille de style de ton site -->
  <link rel="stylesheet" href="/style.css" />

  <style>
    /* === Ajustements locaux pour la démo de jeu === */
    .game-stage {
      position: relative;
      width: 100%;
      max-width: 1100px;
      margin: 24px auto;
      aspect-ratio: 16/9;
      border-radius: 14px;
      overflow: hidden;
      background: #071528;
      border: 1px solid #163b62;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    .game-root {
      position: absolute;
      inset: 0;                 /* le canvas du jeu occupe TOUT le cadre */
    }
    .start-overlay {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-rows: 1fr auto;
      pointer-events: auto;
      z-index: 2;
    }
    .start-overlay.hidden { display: none; }
    .start-overlay .cover {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;        /* pas d’étirement moche */
      filter: saturate(.95) brightness(.98);
    }
    .start-overlay .cta {
      position: relative;
      z-index: 3;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      padding: 14px;
      background: linear-gradient(to top, rgba(7,21,40,.95), rgba(7,21,40,.0) 65%);
    }
    .btn-start {
      appearance: none;
      border: 0;
      border-radius: 12px;
      padding: 12px 18px;
      font: 600 15px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: #0b1f33;
      background: #e6f1ff;
      box-shadow: 0 2px 0 rgba(0,0,0,.2);
      cursor: pointer;
    }
    .btn-start:hover { filter: brightness(1.05); }
    .toolbar {
      display: flex; gap: 8px; flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
      max-width: 1100px;
      margin: 8px auto 0;
    }
    .chip {
      border-radius: 12px; padding: 10px 14px;
      background: #fff; border: 1px solid #e4ecff; color:#0b1f33;
      font: 600 14px/1 system-ui;
    }
  </style>
</head>
<body>

  <main class="container" style="padding: 24px 16px 80px">
    <h1>Runner 2D – Amulettes d’astragale</h1>
    <p>Jeu de découverte des usages de l’astragale (amulette, rite, protection).</p>

    <!-- Petite barre d’actions globales si tu veux en rajouter plus tard -->
    <div class="toolbar" id="osselets-toolbar" aria-hidden="true">
      <div class="chip">Musique : M</div>
      <div class="chip">Pause : P</div>
      <div class="chip">Saut : Espace</div>
      <div class="chip">Déplacer : ← →</div>
    </div>

    <!-- Cadre du jeu -->
    <section id="osselets-anchor" class="game-stage">

      <!-- Overlay screenshot + bouton Start -->
      <div id="osselets-start-overlay" class="start-overlay">
        <img class="cover" id="osselets-cover"
             src="/assets/games/osselets/audio/img/start-screenshot.webp"
             alt="Aperçu du jeu Osselets"
             onerror="this.style.display='none'">
        <div class="cta">
          <button id="osselets-start" class="btn-start">Lancer le niveau 1</button>
        </div>
      </div>

      <!-- Conteneur React pour les niveaux -->
      <div id="osselets-root" class="game-root" role="application" aria-label="Mini-jeu des osselets"></div>
    </section>

    <!-- (Optionnel) Anciennes démos/sections du portfolio en dessous... -->
    <!--
    <section>
      … ton contenu habituel …
    </section>
    -->

    <!-- (Désactivé pour l’instant) Générateur de quizz -->
    <!--
    <section id="quiz" hidden>
      … mis en commentaire comme demandé …
    </section>
    -->
  </main>

  <!-- Librairies (une seule fois) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Niveaux (tsx transpilés côté client). Chaque fichier est déjà dans une IIFE, aucun conflit. -->
  <script type="text/babel" data-presets="typescript,react" src="/osselets-runner.tsx"></script>
  <script type="text/babel" data-presets="typescript,react" src="/osselets-level2.tsx"></script>
  <script type="text/babel" data-presets="typescript,react" src="/osselets-level3.tsx"></script>

  <script>
    // Montage des niveaux dans #osselets-root
    (function () {
      const rootEl = document.getElementById('osselets-root');
      const startOverlay = document.getElementById('osselets-start-overlay');
      const startBtn = document.getElementById('osselets-start');
      const anchor = document.getElementById('osselets-anchor');

      let root = null;

      function ensureRoot() {
        if (!root) root = ReactDOM.createRoot(rootEl);
        return root;
      }

      function scrollIntoView() {
        try { anchor.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch {}
      }

      function getComp(n) {
        if (n === 1) return (window).AstragalusRunner;
        if (n === 2) return (window).AstragalusLevel2;
        if (n === 3) return (window).AstragalusLevel3;
        return null;
      }

      function mountLevel(n) {
        const Comp = getComp(n);
        if (!Comp) return;
        startOverlay.classList.add('hidden');       // on retire le screenshot
        scrollIntoView();
        ensureRoot().render(React.createElement(Comp));
      }

      // Exporte la fonction globale pour enchaîner depuis les niveaux
      (window).__OSSELETS_GOTO_LEVEL = function (n) {
        mountLevel(Number(n) || 1);
      };

      // Bouton Start
      startBtn.addEventListener('click', function () {
        mountLevel(1);
      });
    })();
  </script>
</body>
</html>
