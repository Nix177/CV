<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Portfolio â€” Nicolas Tuor</title>
  <meta name="description" content="Projets et dÃ©mos (Ã©ducation, IA, jeux pÃ©dagogiques)."/>
  <link rel="icon" href="/favicon.ico"/>

  <!-- hreflang -->
  <link rel="alternate" hreflang="fr" href="/portfolio.html">
  <link rel="alternate" hreflang="en" href="/portfolio-en.html">
  <link rel="alternate" hreflang="de" href="/portfolio-de.html">
  <link rel="alternate" hreflang="x-default" href="/portfolio.html">

  <!-- Fallback de styles (ta feuille /style.css continue dâ€™Ãªtre chargÃ©e en dessous) -->
  <style>
    body { margin:0 }
    main.wrap { max-width: 1100px; padding: 16px; margin: 0 auto; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center }
    .btn { padding:8px 12px; border:1px solid #ffffff22; border-radius:10px; background:#0b1f33; color:#e6f1ff; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; gap:6px }
    .btn.ghost { background: transparent }
    .muted { opacity:.9 }
    .card { border:1px solid #ffffff22; border-radius:14px; background:#0b2237cc; padding:14px 16px }
    .grid-cards { display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 840px) { .grid-cards { grid-template-columns: 1fr 1fr; } }

    /* Overlay dâ€™aperÃ§u pour la partie Sites (inchangÃ©) */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.55);
               display: none; z-index: 60; align-items: center; justify-content: center; padding: 18px; }
    .overlay .panel { position: relative; background:#0b2237; border:1px solid #ffffff22; border-radius:12px;
                      width: min(1100px, 100%); height: min(78vh, 100%); overflow: hidden; }
    .overlay .panel header { display:flex; justify-content: space-between; align-items:center; gap:10px;
                             padding:10px 12px; border-bottom:1px solid #ffffff22; color:#fff; }
    .overlay iframe { width:100%; height: calc(100% - 46px); border:0; background:#fff; }

    /* === Styles communs aux mini-jeux === */
    .game-wrap {
      position: relative;
      width: 100%;
      height: clamp(520px, 65vh, 860px);      /* âžœ plus grand pour ton bouton Start */
      overflow: hidden;
      border-radius: 14px;
      background: #071528;
      border: 1px solid #163b62;
    }
    .game-root { position:absolute; inset:0; }
    .cover { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:1; pointer-events:none }
    .cta { position:absolute; left:50%; transform:translateX(-50%); bottom:16px; z-index:2;
           padding:10px 16px; border:1px solid #ffffff33; border-radius:10px; background:#0b1f33; color:#e6f1ff; cursor:pointer }
    .hint { position:absolute; left:12px; top:12px; z-index:3; background:rgba(255,255,255,.92); color:#203050;
            padding:8px 10px; border-radius:8px; border:1px solid #ccdaff; font:14px/1.2 system-ui; }
    canvas { image-rendering: pixelated; }
  </style>

  <!-- Ton style global -->
  <link rel="stylesheet" href="/style.css"/>

  <!-- Nav + feedback (inchangÃ©s) -->
  <script defer src="/assets/js/nav.js"></script>
  <script defer src="/assets/js/feedback.js"></script>
</head>
<body>
  <header class="site-header">
    <nav class="site-nav" aria-label="Navigation principale">
      <ul class="menu">
        <li><a href="/index.html" class="btn ghost">Accueil</a></li>
        <li><a href="/cv.html" class="btn ghost">CV</a></li>
        <li><a href="/portfolio.html" class="btn" aria-current="page">Portfolio</a></li>
        <li><a href="/passions.html" class="btn ghost">Passions</a></li>
        <li><a href="/ai-lab.html" class="btn ghost">Labo IA</a></li>
        <li><a href="/fun-facts.html" class="btn ghost">IdÃ©es reÃ§ues</a></li>
      </ul>
      <ul class="lang">
        <li><a href="/portfolio.html" class="btn" aria-current="page">FR</a></li>
        <li><a href="/portfolio-en.html" class="btn ghost">EN</a></li>
        <li><a href="/portfolio-de.html" class="btn ghost">DE</a></li>
      </ul>
    </nav>
  </header>

  <main class="wrap">
    <h1>Portfolio</h1>
    <p class="muted">Â« Visiter Â» ouvre en nouvel onglet. Â« AperÃ§u Â» tente un embed sÃ©curisÃ© (si autorisÃ© par le site cible).</p>

    <!-- ===== Grille de tes sites (inchangÃ©) ===== -->
    <div id="portfolioGrid" class="grid-cards"></div>

    <!-- AperÃ§u sites (inchangÃ©) -->
    <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="ovlTitle">
      <div class="panel">
        <header>
          <strong id="ovlTitle">AperÃ§u</strong>
          <button id="overlayClose" class="btn">Fermer</button>
        </header>
        <iframe id="overlayFrame" title="AperÃ§u" sandbox="allow-scripts allow-popups"></iframe>
      </div>
    </div>

    <!-- ========== OSSELETS : 3 mini-jeux sÃ©parÃ©s (sans React/Babel) ========== -->

    <section class="card" id="osselets-mj1">
      <h2>ðŸŽ® Mini-jeu 1 â€” Runner (collecte dâ€™amulettes)</h2>
      <div class="row" style="margin-bottom:8px">
        <button class="btn" id="mj1-start">DÃ©marrer</button>
      </div>
      <div class="game-wrap">
        <img class="cover" src="/assets/games/osselets/audio/img/start-screenshot.webp" alt="" onerror="this.remove()">
        <button class="cta" id="mj1-cta">Start</button>
        <div class="game-root" id="mj1-root"></div>
      </div>
    </section>

    <section class="card" id="osselets-mj2">
      <h2>ðŸ§µ Mini-jeu 2 â€” Montage de lâ€™amulette</h2>
      <div class="row" style="margin-bottom:8px">
        <button class="btn" id="mj2-start">DÃ©marrer</button>
      </div>
      <div class="game-wrap">
        <div class="game-root" id="mj2-root"></div>
      </div>
    </section>

    <section class="card" id="osselets-mj3">
      <h2>ðŸ§© Mini-jeu 3 â€” Osselet 3D (trous opposÃ©s)</h2>
      <div class="row" style="margin-bottom:8px">
        <button class="btn" id="mj3-start">DÃ©marrer</button>
      </div>
      <div class="game-wrap">
        <div class="hint" id="mj3-hint">Clique Â« DÃ©marrer Â». Molette = zoom, glisser = rotation.</div>
        <div class="game-root" id="mj3-root"></div>
      </div>
    </section>

  </main>

  <footer class="wrap" style="margin:24px 0 40px;opacity:.8">
    Â© Nicolas Tuor â€” Portfolio
  </footer>

  <!-- DonnÃ©es et scripts de tes cartes (inchangÃ©) -->
  <script src="/portfolio-data.js"></script>
  <script src="/portfolio.js" defer></script>
  <script src="/ai-lab.js" defer></script>

  <!-- ========== BUS AUDIO GLOBAL (mp3) ========== -->
  <script>
    (function(){
      const w = window;
      if (w.__OSSELETS_AUDIO__) return;
      w.__OSSELETS_AUDIO__ = {
        bgm: null,
        sfx: new Set(),
        stopAll(){
          try { this.bgm?.pause(); this.bgm=null; } catch {}
          for (const a of this.sfx) { try { a.pause(); } catch {} }
          this.sfx.clear();
        },
        playBgm(url, volume=0.35){
          try { this.bgm?.pause(); } catch {}
          const a = new Audio(url); a.loop=true; a.volume=volume; this.bgm=a;
          a.play().catch(()=>{}); return a;
        },
        play(url, volume=0.9){
          const a = new Audio(url); a.volume=volume;
          a.play().catch(()=>{}); this.sfx.add(a);
          a.addEventListener('ended', ()=>this.sfx.delete(a));
          return a;
        }
      };
    })();
  </script>

  <!-- ========== MINI-JEU 1 (Runner 2D, Canvas) ========== -->
  <script src="/osselets-mini1.js"></script>

  <!-- ========== MINI-JEU 2 (Montage, Canvas Drag&Drop) ========== -->
  <script src="/osselets-mini2.js"></script>

  <!-- ========== MINI-JEU 3 (Three.js ES Modules) ========== -->
  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { GLTFLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";

    // expose une fonction globale pour dÃ©marrer le mini-jeu 3 (on garde du vanilla ailleurs)
    window.__startMiniJEU3 = async function(){
      const root = document.getElementById("mj3-root");
      const hint = document.getElementById("mj3-hint");
      root.replaceChildren();

      const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
      root.appendChild(renderer.domElement);

      const scene = new THREE.Scene();
      scene.add(new THREE.HemisphereLight(0xffffff,0x8899aa,1.0));
      const dir = new THREE.DirectionalLight(0xffffff,0.8); dir.position.set(1,1,1); scene.add(dir);

      const camera = new THREE.PerspectiveCamera(45, 16/9, 0.05, 100);
      camera.position.set(0.8, 0.6, 1.4);
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping=true; controls.dampingFactor=0.08; controls.target.set(0,0,0);

      const anchors = []; // {obj, face, num}
      const FACE_PAIRS = { ventre:"dos", dos:"ventre", bassin:"membres", membres:"bassin" };

      const url = window.OSSELETS_GLTF_URL || "/assets/games/osselets/3d/astragalus.glb";
      const loader = new GLTFLoader();
      loader.load(url, (g) => {
        const root3 = g.scene || g.scenes?.[0];
        root3.traverse((o) => {
          if (!o.name) return;
          const m = /^Hole_(ventre|dos|bassin|membres)_(\d\d)$/i.exec(o.name);
          if (m) anchors.push({ obj:o, face:m[1].toLowerCase(), num:m[2] });
        });
        root3.scale.setScalar(1.0);
        scene.add(root3);
        if (hint) hint.textContent = `Trouve des paires opposÃ©es â€” ${anchors.length} trous dÃ©tectÃ©s.`;
      });

      const raycaster = new THREE.Raycaster();
      let picked = null;
      renderer.domElement.addEventListener("pointerdown", (ev)=>{
        const rect=renderer.domElement.getBoundingClientRect();
        const mx=(ev.clientX-rect.left)/rect.width*2-1; const my=-((ev.clientY-rect.top)/rect.height*2-1);
        raycaster.setFromCamera({x:mx,y:my}, camera);
        const hit = raycaster.intersectObjects(anchors.map(a=>a.obj), true)[0];
        if (!hit) return;
        const A = anchors.find(a=>a.obj===hit.object || hit.object?.parent===a.obj);
        if (!A) return;
        if (!picked) {
          picked = A;
          if (hint) hint.textContent = `Trou choisi : ${A.face} ${A.num}. Clique le trou opposÃ©.`;
        } else {
          const expect = FACE_PAIRS[picked.face];
          if (A.num===picked.num && A.face===expect) {
            if (hint) hint.textContent = `Bonne paire ${picked.num} (${picked.face} â‡„ ${A.face}).`;
            const a = new THREE.Vector3(); const b = new THREE.Vector3();
            picked.obj.getWorldPosition(a); A.obj.getWorldPosition(b);
            const geom = new THREE.BufferGeometry().setFromPoints([a,b]);
            const line = new THREE.Line(geom, new THREE.LineBasicMaterial({ color:0x2266ff }));
            scene.add(line);
            (window.__OSSELETS_AUDIO__||{}).play?.("/assets/games/osselets/audio/catch-sound.mp3",0.9);
          } else {
            if (hint) hint.textContent = `Pas opposÃ©s : ${picked.face} ${picked.num} â‡„ ${A.face} ${A.num}. RÃ©essaie.`;
            (window.__OSSELETS_AUDIO__||{}).play?.("/assets/games/osselets/audio/ouch-sound.mp3",0.7);
          }
          picked = null;
        }
      });

      const onResize = ()=> {
        const r = root.getBoundingClientRect();
        const w = Math.max(16, r.width), h = Math.max(16, r.height);
        renderer.setSize(w,h,false); camera.aspect = w/h; camera.updateProjectionMatrix();
      };
      new ResizeObserver(onResize).observe(root); onResize();

      function loop(){ requestAnimationFrame(loop); controls.update(); renderer.render(scene, camera); }
      loop();
    }

    // bouton "DÃ©marrer" du mini-jeu 3
    document.getElementById("mj3-start")?.addEventListener("click", ()=>{
      (window.__OSSELETS_AUDIO__||{}).stopAll?.();  // stop BGM des autres mini-jeux
      window.__startMiniJEU3();
    });
  </script>

  <!-- Branche les boutons Start des mini-jeux 1 & 2 -->
  <script>
    // Mini-jeu 1
    document.getElementById("mj1-start")?.addEventListener("click", ()=>{
      window.__startMiniJEU1 && window.__startMiniJEU1();
    });
    document.getElementById("mj1-cta")?.addEventListener("click", ()=>{
      window.__startMiniJEU1 && window.__startMiniJEU1();
    });

    // Mini-jeu 2
    document.getElementById("mj2-start")?.addEventListener("click", ()=>{
      (window.__OSSELETS_AUDIO__||{}).stopAll?.();
      window.__startMiniJEU2 && window.__startMiniJEU2();
    });
  </script>
</body>
</html>
