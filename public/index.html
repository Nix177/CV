<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nicolas Tuor — Accueil</title>

  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate" hreflang="fr" href="/index.html">
  <link rel="alternate" hreflang="en" href="/index-en.html">
  <link rel="alternate" hreflang="de" href="/index-de.html">
  <link rel="alternate" hreflang="x-default" href="/index.html">
  <meta name="theme-color" content="#1a120b" />

  <style>
    :root{
      /* Palette Steampunk / Rétro */
      --bg: #1a120b;           /* Marron très sombre */
      --track: #5a3a2a;        /* Bronze oxydé */
      --station: #ffb703;      /* Or/Laiton brillant */
      --card-bg: #261a15;      /* Fond sombre chaud */
      --card-border: #8c5e35;  /* Bordure cuivre */
      --text: #e6dac3;         /* Couleur papier ancien */
      --muted: #a3927d;        /* Beige grisé */
      --shadow: 0 10px 30px rgba(0,0,0,.65);
      
      --asideW: clamp(300px, 28vw, 420px);
      --asideCollapsed: 64px;
      --asideCurrent: var(--asideW);
    }
    body.panel-collapsed{ --asideCurrent: var(--asideCollapsed); }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      /* Dégradé chaleureux type "lampe à huile" */
      background: radial-gradient(circle at 50% 30%, #3e2723 0%, #0d0805 70%) fixed;
      color:var(--text);
      /* Police avec empattements pour le côté rétro */
      font-family: 'Georgia', 'Times New Roman', serif; 
      overflow:hidden;
    }

    /* ===== Header : brand | boutons ===== */
    :root { --navH: 56px; }
    @media (max-width: 820px){ :root { --navH: 72px; } }

    header:not(#nt-global-nav){
      position: fixed;
      left: 18px;
      right: 18px;
      top: calc(18px + var(--nt-nav-h, 64px));
      z-index: 5;
      display:flex; align-items:center; justify-content:space-between; gap:1rem;
    }

    header:not(#nt-global-nav) > nav.site-nav { display: none !important; }
    
    .brand{
      display:flex; align-items:center; gap:.75rem;
      padding:.6rem .8rem; border-radius:14px;
      /* Fond translucide teinté sépia */
      background:rgba(38, 26, 21, 0.85); backdrop-filter: blur(6px);
      border:1px solid #8c5e35;
      box-shadow: var(--shadow);
      font-weight:800; letter-spacing:.5px;
    }
    .logo{
      width:32px; height:32px; border-radius:9px; display:grid; place-items:center;
      background:linear-gradient(135deg, #8c5e35, #3e2723);
      border:1px solid #ffb703; color: #ffecb3; font-weight:800;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.1);
      flex:0 0 32px;
    }
    
    /* Boutons style Steampunk */
    .btn, .panel-toggle-btn {
        background: linear-gradient(180deg, #5d4037, #3e2723) !important;
        border: 1px solid #8d6e63 !important;
        color: #ffecb3 !important;
        padding:.45rem .7rem; border-radius:10px; font-weight:600; font-size:14px;
        display:inline-flex; align-items:center; gap:.4rem;
        cursor:pointer; text-decoration:none; appearance:none;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 4px 8px rgba(0,0,0,0.4);
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .btn:hover, .panel-toggle-btn:hover { filter: brightness(1.1); }
    .btn:active { transform: translateY(1px); }

    /* ===== Layout ===== */
    main{
      height:100%;
      display:grid;
      grid-template-columns: 1fr var(--asideCurrent);
      gap:18px;
      padding:90px 22px 22px 22px;
      transition: grid-template-columns .25s ease;
    }

    /* ===== Scène rail ===== */
    .scene{
      position:relative; border-radius:18px; overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      border:1px solid #5a3a2a;
      box-shadow: var(--shadow);
      min-height: 480px;
    }
    svg{ width:100%; height:100%; display:block }
    .track{ stroke:var(--track); stroke-width:8; fill:none; }
    .sleepers{ stroke: #3e2723; stroke-width:4; stroke-linecap:round; }

    /* ===== Stations (Images) ===== */
    .station{ cursor:pointer; transform-box: fill-box; transform-origin:center; }
    /* L'image de la station */
    .station .dot { 
        filter: drop-shadow(0 0 5px rgba(255, 183, 3, 0.4)); 
        transition: transform .2s ease, filter .2s ease;
    }
    .station text{ fill:var(--muted); font-size:12px; text-anchor:middle; pointer-events:none; font-family: sans-serif; text-shadow: 0 2px 4px black; }
    .station:hover .dot{ 
        filter: drop-shadow(0 0 10px rgba(255, 183, 3, 0.8)); 
        transform: scale(1.2);
    }
    .hit-rect{ fill:transparent; pointer-events:all; }

    /* ===== Train ===== */
    .train{ filter: drop-shadow(0 10px 20px rgba(0,0,0,.6)); }

    /* ===== Carte centrée sobre ===== */
    .spotlight{
      position:absolute; left:50%; top:50%; transform: translate(-50%,-50%) scale(.96);
      width:min(620px, 76vw); max-width:620px;
      background: rgba(26, 18, 11, 0.96);
      border:1px solid var(--card-border);
      border-radius:16px; padding:16px 18px;
      box-shadow: var(--shadow);
      opacity:0; pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index:6;
    }
    .spotlight.visible{ opacity:1; transform: translate(-50%,-50%) scale(1); pointer-events:auto; }
    .spotlight h4{ margin:.1rem 0 .2rem 0; font-size:22px; color: #ffb703; }
    .spotlight p{ margin:0; color:var(--text); font-size:17px; line-height: 1.5; }

    /* ===== Panneau détails ===== */
    aside{
      position:relative;
      border-left:1px solid rgba(255,255,255,.07);
      background: linear-gradient(180deg, rgba(255,255,255,.02), transparent);
      border-radius:18px; padding:16px 14px 12px 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
      overflow:hidden;
    }
    .panel{
      position:sticky; top:90px; max-height: calc(100vh - 120px);
      display:flex; flex-direction:column; gap:10px; overflow:auto;
      scrollbar-width: thin; scrollbar-color: #8c5e35 transparent;
      opacity:1; transition: opacity .2s ease;
    }
    body.panel-collapsed .panel{ pointer-events:none; opacity:0; }

    .panel .card{ background:var(--card-bg); border:1px solid var(--card-border); border-radius:14px; padding:12px; box-shadow: var(--shadow); }
    .panel .card h4{ margin:.1rem 0 .35rem 0; font-size:16px; color:#ffb703; }
    .panel .card p{ margin:0; color:var(--muted); font-size:14px; font-family: sans-serif; }
    .panel .list{ display:grid; grid-template-columns: 1fr; gap:10px; }

    .panel-toggle-btn{
      position:absolute; inset:auto auto 18px -12px;
      z-index:6; user-select:none;
      border-radius:12px 0 0 12px;
      padding-left: 1.1rem;
    }
    .panel-toggle-btn .chev{ font-size:18px; line-height:1; }
    .panel-toggle-btn .txt{ font-size:13px; }
    body.panel-collapsed .panel-toggle-btn .txt::after{ content:" Tout voir"; }
    body:not(.panel-collapsed) .panel-toggle-btn .txt::after{ content:" Replier"; }

    @media (max-width: 880px){
      main{ grid-template-columns: 1fr; padding-right:12px; padding-left:12px }
      aside{ order:-1; height: var(--asideCollapsed); }
      body:not(.panel-collapsed) aside{ height:auto; }
      .panel-toggle-btn{ inset:-12px auto auto 18px; border-radius:12px; }
    }
  </style>
  <link rel="stylesheet" href="/style.css">
  <script defer src="/assets/js/nav.js"></script>
  <script defer src="/assets/js/feedback.js"></script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body class="panel-collapsed">
  <header aria-label="En-tête">
    <nav class="site-nav" aria-label="Navigation">
      <ul class="menu">
        <li><a href="/index.html" aria-current="page">Accueil</a></li>
        <li><a href="/cv.html">CV</a></li>
        <li><a href="/portfolio.html">Portfolio</a></li>
        <li><a href="/passions.html">Passions</a></li>
        <li><a href="/ai-lab.html">Labo IA</a></li>
        <li><a href="/fun-facts.html">Idées reçues</a></li>
      </ul>
      <ul class="lang">
        <li><a href="/index.html" aria-current="page">FR</a></li>
        <li><a href="/index-en.html">EN</a></li>
        <li><a href="/index-de.html">DE</a></li>
      </ul>
    </nav>

    <div class="brand">
      <div class="logo" aria-hidden="true">N·T</div>
      <div>Nicolas Tuor — <span style="color:var(--muted)">éducation, sciences & technologies - créé en collaboration avec ChatGpt et Gemini; work in progress</span></div>
    </div>
  </header>

  <main>
    <section class="scene" aria-label="Ligne principale — stations de convictions">
      <svg id="metro" viewBox="0 0 1600 900" preserveAspectRatio="xMidYMid slice" role="img">
        <defs>
          <filter id="steam-glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
            <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
          <linearGradient id="headlight-grad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#ffb703; stop-opacity:0.6" />
            <stop offset="100%" style="stop-color:#ffb703; stop-opacity:0" />
          </linearGradient>
        </defs>

        <path id="track" class="track" d="" style="stroke: var(--track); stroke-width: 6;" />
        <g id="sleepers" class="sleepers" style="stroke: #3e2723;"></g>
        <g id="stations"></g>
        
      <g id="train">
          <path d="M 10,0 L 180,-30 L 180,30 Z" fill="url(#headlight-grad)" style="mix-blend-mode: screen; filter: url(#steam-glow);" />
          
          <image href="/assets/train.png" x="-30" y="-15" width="60" height="30" /> 
        </g>
      </svg>

      <div id="spotlight" class="spotlight" role="dialog" aria-live="polite" aria-label="Idée sélectionnée">
        <h4 id="spotTitle"></h4>
        <p id="spotText"></p>
      </div>
    </section>

    <aside>
      <div role="button" aria-pressed="false" tabindex="0" class="panel-toggle-btn" id="panelToggle">
        <span class="chev">❯</span><span class="txt"></span>
      </div>
      <div class="panel" id="panel">
        <div class="card">
          <h3>Convictions & lignes directrices</h3>
          <div class="meta" style="color:var(--muted);font-size:12px">
            Utilise le bouton pour ouvrir/fermer. Clique une station pour les détails.
          </div>
        </div>
        <div class="list" id="detail-list"></div>
      </div>
    </aside>
  </main>

  <script>
    /* ===== Données des stations ===== */
    const STATIONS = [
      { title:"Pensée critique", short:"Analyser, douter méthodiquement.", detail:"Formuler des questions testables, croiser les sources, argumenter avec preuves et critères." },
      { title:"Apprentissage tout au long de la vie", short:"Autodidacticité outillée.", detail:"Routines, ressources, outils et techniques pour apprendre vite et mieux, durablement." },
      { title:"Goût de l’apprentissage", short:"Curiosité et passion.", detail:"Je suis passionné par tous les types d'apprentissages et persuadé qu'on peut tout rendre intéressant." },
      { title:"Pédagogie par projets", short:"Problèmes réels, livrables concrets.", detail:"De la définition du besoin à la restitution, projets ancrés et collaboratifs qui font sens." },
      { title:"Émerveillement", short:"Mieux comprendre le monde pour l'apprécier.", detail:"Plus on en sait sur le fonctionnement et l'existance de choses plus le monde est magique." },
      { title:"Médiation & vulgarisation", short:"Transmettre science & culture.", detail:"Apprendre quelque chose n'a de sens pour moi que si je peux le partager, cf passion ppur l'apprentissage et émerveillement." },
      { title:"Communautés de pratiques", short:"Apprendre entre pairs.", detail:"Espaces de mutualisation, réseaux réellement sociaux sains de partage pour apprendre ensemble et soutenir les apprentissages." },
      { title:"Apprendre par l’erreur", short:"Essai→feedback→amélioration.", detail:"Erreur = signal d’info ; si on ne se trompe jamais on ne s'améliore pas. Les systèmes d'évaluations sont perfectibles (portfolio)." },
      { title:"Open science / open education", short:"Ouvrir, socio-constructivisme.", detail:"Réutilisabilité (licences, dépôts, gabarits) pour diffuser et équiper équitablement." },
      { title:"Environnements capacitants", short:"Rendre capables d’agir.", detail:"Ajuster outils, contraintes et soutiens pour développer capabilités et initiative au lieu d'imposer." },
      { title:"Cours de technologie", short:"Construire, coder, documenter, analyser.", detail:"Apprendre les technologies au sens large et durable. Mieux comprendre les outils qui nous entourent et leur fonctionnement." },
      { title:"Méthodologie scientifique", short:"Hypothèses, protocoles, mesures.", detail:"Lecture, veille et rédaction aux standards scientifiques." },
      { title:"Populariser pour tous", short:"Formations utiles aux adultes de tous horizons.", detail:"Parcours modulaires, clés en main, sans jargon inutile. Décloisonner les savoirs et la recherche." },
      { title:"Extended mind", short:"Outiller la cognition.", detail:"Évaluer et intégrer les artefacts qui augmentent mémoire, attention, jugement." },
      { title:"Évaluation : changer de paradigme", short:"Évaluer pour apprendre.", detail:"Preuves authentiques, critères explicites, feedbacks exploitables, ne pas dégouter des apprentissages." },
      { title:"YouTube & ressources utiles", short:"Formats prophanes de qualité.", detail:"Sélection et scénarisation pour profs — moins de bruit, plus de valeur." },
      { title:"On ne peut pas être expert en tout", short:"Relier les expertises.", detail:"Tisser des ponts et curer l’essentiel selon la valeur d’usage." },
      { title:"Consulting scientifique", short:"Relier recherche et décision.", detail:"Lecture méthodique, critères de preuve, recommandations opérantes sans cupidité." }
    ];

    /* ===== Refs DOM ===== */
    const svg = document.getElementById('metro');
    const track = document.getElementById('track');
    const sleepers = document.getElementById('sleepers');
    const stationLayer = document.getElementById('stations');
    const train = document.getElementById('train');

    const panelToggle = document.getElementById('panelToggle');
    const detailList = document.getElementById('detail-list');

    const spotlight = document.getElementById('spotlight');
    const spotTitle = document.getElementById('spotTitle');
    const spotText  = document.getElementById('spotText');

    /* ===== Géométrie & ligne ===== */
    let totalLen = 0;
    let stationPositions = [];
    const sleeperStep = 46;

    function buildZigZagPath(preserve=true){
      const {width:W, height:H} = svg.viewBox.baseVal;
      const topY = H*0.28, botY = H*0.72;
      const left = 80, right = W-80, segs = 8;

      const dx = (right-left)/segs;
      let d = `M ${left},${topY}`;
      for(let i=1;i<=segs;i++){
        const x = left + i*dx;
        const y = (i%2===0)? topY-60 : topY+60;
        d += ` L ${x},${y}`;
      }
      d += ` L ${right},${topY}`;
      d += ` L ${right},${botY}`;
      for(let i=segs-1;i>=0;i--){
        const x = left + i*dx;
        const y = ((i%2)===0)? botY+60 : botY-60;
        d += ` L ${x},${y}`;
      }
      d += ` L ${left},${botY}`;
      d += ` L ${left},${topY}`;

      let ratio = 0;
      if(preserve && totalLen>0) ratio = pos / totalLen;

      track.setAttribute('d', d);
      renderSleepers();

      totalLen = track.getTotalLength();
      pos = ratio * totalLen;
    }

    function renderSleepers(){
      sleepers.innerHTML = '';
      const L = track.getTotalLength();
      for(let s = 0; s < L; s += sleeperStep){
        const p = track.getPointAtLength(s);
        const prev = track.getPointAtLength(Math.max(0, s - 1));
        const angle = Math.atan2(p.y - prev.y, p.x - prev.x) + Math.PI/2;
        const len = 16;
        const x1 = p.x - Math.cos(angle)*len;
        const y1 = p.y - Math.sin(angle)*len;
        const x2 = p.x + Math.cos(angle)*len;
        const y2 = p.y + Math.sin(angle)*len;
        const seg = document.createElementNS('http://www.w3.org/2000/svg','line');
        seg.setAttribute('x1', x1); seg.setAttribute('y1', y1);
        seg.setAttribute('x2', x2); seg.setAttribute('y2', y2);
        sleepers.appendChild(seg);
      }
    }

    function placeStations(){
      stationLayer.innerHTML = '';
      stationPositions = [];
      const N = STATIONS.length;

      for(let i=0;i<N;i++){
        const len = (i+0.5) * (totalLen / N);
        const p = track.getPointAtLength(len);
        stationPositions.push({ len, x:p.x, y:p.y, idx:i });

        const g = document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('class','station');
        g.setAttribute('data-idx', i);
        g.setAttribute('transform', `translate(${p.x},${p.y})`);

        const hitRect = document.createElementNS('http://www.w3.org/2000/svg','rect');
        hitRect.setAttribute('class','hit-rect');
        hitRect.setAttribute('x', -30);
        hitRect.setAttribute('y', -30);
        hitRect.setAttribute('width', 60);
        hitRect.setAttribute('height', 60);

        // --- IMAGE STATION ---
        const icon = document.createElementNS('http://www.w3.org/2000/svg','image');
        icon.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '/assets/station.png');
        icon.setAttribute('width', 48);
        icon.setAttribute('height', 48);
        icon.setAttribute('x', -24);
        icon.setAttribute('y', -24);
        icon.setAttribute('class', 'dot'); // Garder la classe pour les effets CSS

        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('y', -24);
        label.textContent = STATIONS[i].title;

        g.appendChild(hitRect); 
        g.appendChild(icon); 
        g.appendChild(label);
        
        g.addEventListener('mouseenter', () => onHoverStation(i));
        g.addEventListener('mouseleave', () => onLeaveStation(i));
        g.addEventListener('click', () => openDetail(i));
        stationLayer.appendChild(g);
      }
    }

    /* ===== Spotlight (centre, sobre) ===== */
    let currentIdx = null;
    let hoverLockIdx = null;
    let autoHide = null;
    const lingerAuto = 4200;   // auto (train)
    const lingerHover = 160;   // petit délai au leave

    function showSpotlight(i, source){
      currentIdx = i;
      const st = STATIONS[i];
      spotTitle.textContent = st.title;
      spotText.textContent = st.short;

      spotlight.classList.add('visible');

      clearTimeout(autoHide);
      if(source === 'auto'){
        autoHide = setTimeout(()=> hideSpotlight(), lingerAuto);
      }
    }

    function hideSpotlight(){
      clearTimeout(autoHide);
      spotlight.classList.remove('visible');
      currentIdx = null;
    }

    /* ===== Survol station ===== */
    function onHoverStation(i){
      hoverLockIdx = i;
      showSpotlight(i,'hover');
    }
    function onLeaveStation(i){
      if(hoverLockIdx!==i) return;
      hoverLockIdx = null;
      setTimeout(()=>{ if(hoverLockIdx===null) hideSpotlight(); }, lingerHover);
    }

    /* ===== Panneau détails ===== */
    function renderDetailList(){
      detailList.innerHTML = '';
      STATIONS.forEach((st, i) => {
        const item = document.createElement('div');
        item.className = 'card';
        item.innerHTML = `<h4>${esc(st.title)}</h4><p>${esc(st.detail)}</p>`;
        item.style.cursor = 'pointer';
        item.addEventListener('click', () => {
          showSpotlight(i,'manual');
          focusStation(i);
        });
        detailList.appendChild(item);
      });
    }
    function openDetail(i){
      document.body.classList.remove('panel-collapsed');
      panelToggle.setAttribute('aria-pressed','true');
      const panel = document.getElementById('panel');
      const head = document.createElement('div');
      head.className = 'card';
      head.innerHTML = `<h4>➜ ${esc(STATIONS[i].title)}</h4><p>${esc(STATIONS[i].detail)}</p>`;
      panel.prepend(head);
      panel.scrollTo({ top:0, behavior:'smooth' });
      focusStation(i);
    }
    function focusStation(i){
      const node = stationLayer.querySelector(`.station[data-idx="${i}"]`);
      if(!node) return;
      const dot = node.querySelector('.dot'); // cible l'image
      if(!dot) return;
      dot.animate(
        [
          { filter:'drop-shadow(0 0 0 rgba(0,0,0,0))' },
          { filter:'drop-shadow(0 0 15px rgba(255,183,3,0.9))' }, // Lueur or
          { filter:'drop-shadow(0 0 0 rgba(0,0,0,0))' }
        ],
        { duration:500, easing:'ease-out' }
      );
    }

    function esc(str){ return str.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    /* ===== Animation du train + auto spotlight ===== */
    // Configuration du mouvement
    let speed = 0.8;          // Vitesse de croisière
    let currentSpeed = 0.8;   // Vitesse actuelle (pour accélération/freinage)
    let pos = 0;
    let lastT = performance.now();
    
    // Gestion des arrêts
    let stationWait = 0;      // Temps d'attente restant (ms)
    const STOP_DURATION = 1000; // Durée d'arrêt à une station (ms)
    let lastStationIdx = -1;  // Pour ne pas s'arrêter 2 fois à la même
    
    const showRadius = 32;
    let lastShownIdx = -1;
    let cooldownUntil = 0;

    function tick(t) {
      const dt = Math.min(40, t - lastT); // dt en ms
      lastT = t;
      const now = performance.now();

      // Si on est à l'arrêt
      if (stationWait > 0) {
        stationWait -= dt;
        // On force la vitesse à 0 pour l'effet visuel si besoin
        currentSpeed = 0;
        // On continue d'appeler tick pour reprendre plus tard
        requestAnimationFrame(tick);
        return;
      }

      // Reprise de vitesse (accélération douce)
      if (currentSpeed < speed) currentSpeed += 0.05;

      // Avancer
      pos += currentSpeed;
      if (pos > totalLen) {
        pos -= totalLen;
        lastStationIdx = -1; // Reset tour
      }

      // Calcul position & rotation
      const p = track.getPointAtLength(pos);
      // On prend un point un peu plus loin pour calculer l'angle (tangente)
      const p2 = track.getPointAtLength((pos + 2) % totalLen); 
      const angle = Math.atan2(p2.y - p.y, p2.x - p.x) * 180 / Math.PI;

      // Appliquer au groupe train (position + rotation)
      train.setAttribute('transform', `translate(${p.x},${p.y}) rotate(${angle})`);

      // --- LOGIQUE DES STATIONS ---
      // On cherche si on est proche d'une station pour s'arrêter
      for(const s of stationPositions){
        // Distance simple sur la ligne
        const dist = Math.abs(pos - s.len);
        
        // Zone de détection (ex: 5 pixels avant/après)
        if(dist < 5 && s.idx !== lastStationIdx){
          // ARRÊT !
          stationWait = STOP_DURATION;
          lastStationIdx = s.idx;
          currentSpeed = 0; // Stop net
          
          // Effet Spotlight (déjà existant dans ton code)
          if(hoverLockIdx === null){
             lastShownIdx = s.idx;
             showSpotlight(s.idx, 'auto');
          }
          break; 
        }
        
        // Zone de freinage (ex: 50 pixels avant)
        if (s.len > pos && (s.len - pos) < 50 && s.idx !== lastStationIdx) {
           // On ralentit progressivement
           currentSpeed = Math.max(0.5, currentSpeed * 0.95);
        }
      }

      requestAnimationFrame(tick);
    }

    /* ===== Init ===== */
    function init(){
      buildZigZagPath(false);
      totalLen = track.getTotalLength();
      placeStations();
      renderDetailList();
      lastT = performance.now();
      requestAnimationFrame(tick);

      // Toggle panneau
      panelToggle.addEventListener('click', () => {
        const collapsed = document.body.classList.toggle('panel-collapsed');
        panelToggle.setAttribute('aria-pressed', collapsed ? 'false' : 'true');
      });
      panelToggle.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); panelToggle.click(); }
      });

      // Resize
      let to=null;
      window.addEventListener('resize', ()=>{ clearTimeout(to); to=setTimeout(()=>{
        buildZigZagPath(); placeStations();
      }, 120); });
    }
    init();
  </script>
  <script src="/assets/js/site.js" defer></script>
</body>
</html>
